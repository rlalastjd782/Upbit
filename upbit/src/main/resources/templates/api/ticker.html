<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<meta charset="UTF-8">
<!-- CSS only -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
	crossorigin="anonymous">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script type="text/javascript"
	src="https://www.gstatic.com/charts/loader.js"></script>
<title>Welcome Coin</title>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<div class="container-fluid">
			<a class="navbar-brand" href="#">Easy-Pick CoinMarket</a>
			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarColor01"
				aria-controls="navbarColor01" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarColor01">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
					<li class="nav-item"><a class="nav-link active"
						aria-current="page" th:href=@{/}>Home</a></li>
					<li class="nav-item"><a class="nav-link"
						th:href=@{/v1/market/all}>코인상세정보</a></li>
					<li class="nav-item"><a class="nav-link" th:href=@{/graph}>코인그래프</a>
					<li class="nav-item"><a class="nav-link"
						th:href="@{/analysis}">급등분석</a></li>
					<li class="nav-item"><a class="nav-link" th:href="@{/ticker}">상승하락</a>
					</li>
				</ul>
				<form class="d-flex">
					<input class="form-control me-2" type="search" placeholder="Search"
						aria-label="Search">
					<button class="btn btn-outline-light" type="submit">Search</button>
				</form>
			</div>
		</div>
	</nav>

	<select id="upbitAll">
		<option value="">코인을 골라주세요</option>
		<option id='coinName' th:each="items: ${model}"
			th:if="${#strings.contains(items.market,'KRW')}"
			th:value="${items.market}" th:text="${items.korean_name}"></option>
	</select>
	<button id="selectButton">급등 조회</button>
	
	<input type = text id = "inputValue" value = '코인이름을 넣어주세요!'/>
	<button id = "coinTextSearch">검색하기</button>
	
	<table class="table" id="dataMarket">
		<thead>
			<tr>
				<th scope="col">코인이름</th>
				<th scope="col">현재가(원)</th>
				<th scope="col">전일종가</th>
				<th scope="col">변화액</th>
				<th scope="col">전일대비변화율</th>
				<th scope="col">누적거래대금(백만원,1일)</th>
				<th scope="col">상승보합정보</th>
			</tr>
		</thead>
	</table>
	

	

	<!-- JavaScript Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
		crossorigin="anonymous"></script>

	<script>

/*<![CDATA[*/	
	$('#selectButton').click(function(){
		var selectMarketName = $('select').val();
		console.log(selectMarketName);
		$.ajax({
			type : "GET",
			url : ("https://api.upbit.com/v1/ticker?markets="+selectMarketName),
			dataType : 'json',
			success: function (res){
				console.log(res)
				var resJson = res[0]
				var change = resJson.change;// fall 하락 even 보합 rise 상승
				//변화액은 전일종가 대비 현재가
				var prevClosingPrice =  Math.floor(resJson.prev_closing_price).toLocaleString('ko-kr') // 전일종가
				var tradePrice = Math.floor(resJson.trade_price).toLocaleString('ko-kr') // 현재가 
				var changePrice = Math.floor(resJson.signed_change_price).toLocaleString('ko-kr')	//부호가있는 변화액
				var changeRate = resJson.signed_change_rate // 부호가 있는 변화율 
				var accTradePriceOneDay = Math.floor(resJson.acc_trade_price_24h/1000000).toLocaleString('ko-kr');// 24시간 누적 거래대금 // 업비트에서 거래대금으로 나오는 부분
				var changeRateInsert = changeRate*100;
				if(change=='FALL'){
					change = '하락'
				}else if(change == 'EVEN'){
					change = '보합'
				}else{
					change = '상승'
				}
				html='';
				html+=
					  "<tbody><tr><td>" + selectMarketName + "</td>"
					 	+ "<td>" + tradePrice + "</td>"
						+ "<td>" + prevClosingPrice + "</td>"
						+ "<td>" + changePrice + "원</td>"
						+ "<td>" + changeRateInsert.toFixed(2) +"%</td>"
						+ "<td>" + accTradePriceOneDay + "백만원</td>"
						+ "<td>" + change + "</td></tr></tbody>"
					 $("#dataMarket").append(html)
				
				
			}
		})
		
		
	});
	
	$('#coinTextSearch').click(function(){
	    var inputValue = document.getElementById('inputValue').value;
	    console.log(inputValue)
	    
	    var coinName ;
	    coinName = document.getElementById('coinName').text;
	    console.log(coinName)
	})
	
	
	
	
	
	



   /*]]>*/
</script>


</body>
</html>
